<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>PlayMax</title>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <a href="/index.html" class="logo-link">
                <img src="./img/logoPM.png" alt="PlayMax Logo" class="logo">
            </a>
            <nav class="main-nav">
                <ul>
                    <li><a href="/peliculas.html">Películas</a></li>
                    <li><a href="./series.html">Series</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-right">
            <a href="#" class="profile-link">
                <img src="./img/background_replace_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png" alt="Perfil" class="profile-icon">
            </a>
        </div>
    </header>

    <main class="register-page-main">
        <section class="register-section full-height">
            <div class="register-container">
                <h2>Crea tu Cuenta en PlayMax</h2>
                <form class="register-form">
                    <div class="form-section">
                        <h3>Información Personal</h3>
                        <div class="form-group">
                            <label for="first-name">Nombre</label>
                            <input type="text" id="first-name" name="first_name" placeholder="Tu nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="last-name">Apellido</label>
                            <input type="text" id="last-name" name="last_name" placeholder="Tu apellido" required>
                        </div>
                        <div class="form-group">
                            <label for="dob">Fecha de Nacimiento</label>
                            <input type="date" id="dob" name="dob" required>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Detalles de la Cuenta</h3>
                        <div class="form-group">
                            <label for="username">Nombre de Usuario</label>
                            <input type="text" id="username" name="username" placeholder="Elige un nombre de usuario" required>
                        </div>
                        <div class="form-group">
                            <label for="email-register">Correo Electrónico</label>
                            <input type="email" id="email-register" name="email" placeholder="tu@ejemplo.com" required>
                        </div>
                        <div class="form-group">
                            <label for="password-register">Contraseña</label>
                            <input type="password" id="password-register" name="password" placeholder="Mínimo 8 caracteres" required>
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirmar Contraseña</label>
                            <input type="password" id="confirm-password" name="confirm_password" placeholder="Repite tu contraseña" required>
                        </div>
                    </div>

                    <div class="form-terms">
                        <label class="terms-checkbox">
                            <input type="checkbox" id="accept-terms" required>
                            Acepto los <a href="#" class="terms-link">Términos de Servicio</a> y la <a href="#" class="terms-link">Política de Privacidad</a>.
                        </label>
                    </div>

                    <button type="submit" class="register-button">Registrarme</button>
                    <p class="login-text">¿Ya tienes una cuenta? <a href="./login.html" class="login-link">Inicia Sesión aquí</a></p>
                </form>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <a href="#">
                    <img src="./img/logoPM.png" alt="PlayMax Logo Footer" class="logo-footer">
                </a>
                <p>&copy; 2025 PlayMax. Todos los derechos reservados.</p>
            </div>

            <nav class="footer-nav">
                <h3>Navegación</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Películas</a></li>
                    <li><a href="#">Series</a></li>
                    <li><a href="#">Mi Lista</a></li>
                    <li><a href="#">Contacto</a></li>
                </ul>
            </nav>

            <div class="footer-links">
                <h3>Ayuda y Soporte</h3>
                <ul>
                    <li><a href="#">Política de Privacidad</a></li>
                    <li><a href="#">Contáctanos</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Hecho con ❤️ en Medellín, Colombia.</p>
        </div>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC7PhfZwbP7QcZO8vCKwSQuuTjKt7Br4OQ",
            authDomain: "playmax-6bc40.firebaseapp.com",
            databaseURL: "https://playmax-6bc40-default-rtdb.firebaseio.com",
            projectId: "playmax-6bc40",
            storageBucket: "playmax-6bc40.firebasestorage.app",
            messagingSenderId: "972267905771",
            appId: "1:972267905771:web:485787c59922ce951094ae",
            measurementId: "G-GMYC8DCLTF"
        };


        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();


        function showAlert(message, isSuccess) {
            const alertDiv = document.createElement('div');
            alertDiv.className = isSuccess ? 'success-alert' : 'error-alert';
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                }, 500);
            }, 3000);
        }

        // registro de usuario
        document.querySelector('.register-form').addEventListener('submit', function(e) {
            e.preventDefault();

            // valores de formulario
            const email = document.getElementById('email-register').value;
            const password = document.getElementById('password-register').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const username = document.getElementById('username').value;
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const dob = document.getElementById('dob').value;

            // Validaciones
            if (password !== confirmPassword) {
                showAlert('Las contraseñas no coinciden', false);
                return;
            }

            if (password.length < 6) {
                showAlert('La contraseña debe tener al menos 6 caracteres', false);
                return;
            }


            showAlert('Registrando usuario...', true);

            // Registrar usuario en Base de Datos
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {

                    const user = userCredential.user;

                    // Guardar información
                    const userData = {
                        username: username,
                        firstName: firstName,
                        lastName: lastName,
                        dob: dob,
                        email: email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    };

                    // Guardar en la base de datos
                    return database.ref('users/' + user.uid).set(userData);
                })
                .then(() => {

                    showAlert('¡Registro exitoso! Redirigiendo...', true);
                    setTimeout(() => {
                        window.location.href = "index.html";
                    }, 2000);
                })
                .catch((error) => {

                    let errorMessage = "Error en el registro: ";

                    switch(error.code) {
                        case "auth/email-already-in-use":
                            errorMessage = "El email ya está en uso";
                            break;
                        case "auth/invalid-email":
                            errorMessage = "Email inválido";
                            break;
                        case "auth/weak-password":
                            errorMessage = "Contraseña demasiado débil";
                            break;
                        default:
                            errorMessage += error.message;
                    }

                    showAlert(errorMessage, false);
                    console.error("Error de registro:", error);
                });
        });

        document.querySelector('.login-link').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = "login.html";
        });
    </script>
</body>
</html>
